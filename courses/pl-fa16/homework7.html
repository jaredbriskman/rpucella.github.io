<!DOCTYPE html>
<html>

  <head>
    
    <meta charset="utf-8">
    <title>Homework 7</title>

    <link rel="stylesheet" href="alt.css" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,800,700' rel='stylesheet' type='text/css'>

    <script src="autoscroll.js"></script>
    
    <style>

      hr { margin-top: 50px; }

        code,tt,pre {
          font-size: 130%;
        }
	
        div.lect {
	  padding-top: 0;
       	  padding-left: 3em;
	  margin-top:0;
        }
    	p.ann { 
    	  padding-left: 3em;
    	  text-indent: -3em; 
    	}
	p.ann_ctd{
	  padding-left: 3em;
        }
    	span.hdr {
   	  padding-right: 1em
    	}

	.hidden {
	  visibility: hidden;
        }

        tt.code {
           background: #e6e6e6;
        }

	pre.code {
	   border: 1px solid #c6c6c6;
	border-radius: 5px;
	padding: 10px;
	font-size:100%;
      }

      pre.blue {
      color: blue;
      }

      span.comment {
      color:#aaaaaa;
      font-style:italic;
      }
      
/* from
    http://www.456bereastreet.com/archive/201105/styling_ordered_list_numbers/
 */

ol {
    counter-reset:li; /* Initiate a counter */
    margin-left:0; /* Remove the default left margin */
    padding-left:0; /* Remove the default left padding */
    padding-top:1em;
}
ol > li {
    position:relative; /* Create a positioning context */
    margin:0 0 6px 2em; /* Give each list item a left margin to make
    room for the numbers */
    padding:4px 8px; /* Add some spacing around the content */
    list-style:none; /* Disable the normal item numbering */
    /*border-top:2px solid #666;
    background:#f6f6f6; */
}
ol > li:before {
    counter-increment:li; /* Increment the counter by 1 */
    /* Position and style the number */
    position:absolute;
    top:-2px;
    left:-2em;
    -moz-box-sizing:border-box;
    -webkit-box-sizing:border-box;
    box-sizing:border-box;
    width:2em;
    /* Some space between the number and the content in browsers that
    support
       generated content but not positioning it (Camino 2 is one
    example) */
    margin-right:8px;
    padding:4px;
/*    border-top:2px solid #666;
    color:#fff;
    background:#666; 
    font-weight:bold; */
/*    font-family:"Helvetica Neue", Arial, sans-serif;
    text-align:center; */
}

ol.letter > li:before {
    content:"(" counter(li,lower-alpha) ")"; /* Use the counter as content */
}

ol.number > li:before {
    content:"(" counter(li,decimal) ")"; /* Use the counter as content */
}

li ol,
li ul {margin-top:6px;}

li > p { margin-top:0;}

    </style>

  </head>


  <body>

    <div class="navbar">

      <div class="home">
	<a href="../../index.html"><img src="../../home.png" style="height: 1.6em;"></a>
      </div>

      <ul>
	<li><a href="index.html"><b>Programming Languages FA16</b></a></li> 
	<li class="hidden"><a class="scrollto" href="#announcements">Announcements</a></li>
	<li class="hidden"><a class="scrollto" href="#info">Course Info</a></li>
	<li class="hidden"><a class="scrollto" href="#lectures">Lectures</a></li>
	<li class="hidden"><a class="scrollto" href="#homeworks">Homeworks</a></li>
      </ul>
    </div>


    <!-- padding -->
    <div id="top" style="height: 7em;"></div>
    
    <h1 class="clear">Homework 7</h1>
    
    <p class="subtitle">Due date: Friday, Nov 18, 2016 (11:59:59pm)</p>

    <p><b>Note on integrity:</b> This homework is meant to be done in teams of two. 
    You may discuss problems with fellow students, but
    all work must be entirely that of your team, and should not be from any
    other course, present, past, or future. If you use a solution from
    another source you must cite it &mdash; this includes when that source
      is someone else helping you.</p>

    <p>Every source file you submit should begin with a block comment
      that lists <span style="text-decoration:underline;">the members of your team</span>, your <span style="text-decoration:underline;">email addresses</span>, and any <span style="text-decoration:underline;">remarks</span> that you
      wish to make to the instructor.</p>

    <p>All programming is to be done in Python 2.7.</p>

    <!-- <p>Feel free to define helper functions if you need them.</p> -->

    <p>Electronic submission instructions:</p>

    <ul>
      <li>Send an email with your file <tt>homework7.py</tt> as an attachment to <tt>pl.fa16.olin@gmail.com</tt> with subject <i>Homework 7 submission</i>. Only one email per team, please.</li>
    </ul>

    <p><b>Additional instructions for Homework 7 submission:</b> Along
    with your usual submission of the <tt>homework7.py</tt> file
    containing your source code, please put in a comment at the top of
    your file describing any deviation you have made from this
    specification. I will test your code by running it on sample
    programs, and I want to make sure that you do not get penalized
    for, say, failing to successfully parse a program (and therefore
    execute it) because you decided to change the grammar of the
    language slightly. </p>

    <hr>

    <p>In this homework, we bring together everything we learned about interpretation to implement an interpreter for a reasonably complete programming language I'm going to call PJ (for Python/JavaScript): imperative, with first-class functions, mutable variables, mutable arrays (lists), and dictionaries.</p>

    <p>In contrast with all previous homeworks, I'm not going to give
    you any starting code. But you are <i>strongly</i> encouraged to
    pull from all the various interpreters we've written the pieces
    that you'll need to put this one together. You should not have to
    reinvent the parser, the abstract representation, or the evaluation process, unless you really want to.</p>

    <h3>The Language</h3>

    <p>Here is the desired syntax.</p>

    <p>Expressions evaluate to values:</p>

<pre class="blue">
  <i>expr</i> ::= <i>integer literal</i>                       <span class="comment"># of the form 123 or -456</span>
           <i>boolean literal</i>                       <span class="comment"># true , false</span>
	   <i>string literal</i>                        <span class="comment"># of the form "xyz"</span>
 	   <i>id</i>                                    <span class="comment"># starts with a letter or _</span>
	   <i>expr</i> <b>+</b> <i>expr</i>                           <span class="comment"># adds integers / concatenates arrays / concatenates strings</span>
	   <i>expr</i> <b>*</b> <i>expr</i>
	   <i>expr</i> <b>-</b> <i>expr</i>
	   <i>expr</i> <b>==</b> <i>expr</i>                          <span class="comment"># equality (all types)</span>
	   <i>expr</i> <b>></b> <i>expr</i>                           <span class="comment"># for integers and strings (lexicographic order)</span>
	   <i>expr</i> <b>>=</b> <i>expr</i>                          <span class="comment"># for integers and strings (lexicographic order)</span>
	   <i>expr</i> <b><</b> <i>expr</i>                           <span class="comment"># for integers and strings (lexicographic order)</span>
	   <i>expr</i> <b><=</b> <i>expr</i>                          <span class="comment"># for integers and strings (lexicographic order)</span>
	   <i>expr</i> <b><></b> <i>expr</i>                          <span class="comment"># this is "not equal" (all types)</span>
	   <i>expr</i> <b>and</b> <i>expr</i>                         <span class="comment"># short-circuiting</span>
	   <i>expr</i> <b>or</b> <i>expr</i>                          <span class="comment"># short-circuiting</span>
	   <b>not</b> <i>expr</i>                                     
	   <b>let</b> <b>(</b> <i>id</i> <b>=</b> <i>expr</i> <b>,</b> ... <b>)</b> <i>expr</i>          <span class="comment"># local binding</span>
	   <i>expr</i> <b>?</b> <i>expr</i> <b>:</b> <i>expr</i>                    <span class="comment"># conditional</span>
	   <i>expr</i> <b>(</b> <i>expr</i> <b>,</b> ... <b>)</b>                   <span class="comment"># function call</span>
	   <b>(</b> <i>expr</i> <b>)</b>
	   <b>[</b> <i>expr</i> <b>,</b> ... <b>]</b>                        <span class="comment"># creates an array</span>
	   <b>fun</b> <b>(</b> <i>id</i> <b>,</b> ... <b>)</b> <i>body</i>                 <span class="comment"># anonymous function</span>
	   <b>fun</b> <i>id</i> <b>(</b> <i>id</i> <b>,</b> ... <b>)</b> <i>body</i>              <span class="comment"># recursive anonymous function</span>
	   <b>{</b> <i>id</i> <b>:</b> <i>expr</i> <b>,</b> ... <b>}</b>                   <span class="comment"># dictionary (record)</span>
	   <i>expr</i> <b>[</b> <i>expr</i> <b>]</b>                         <span class="comment"># array or string (<i>a[2]</i>) or dictionary (<i>a["x"]</i>) indexing</span>  
</pre>

    <p>Values include: integers, Booleans, strings, arrays, dictionaries (records), and functions (closures). It may be useful to have a <tt>none</tt> value, and a literal for it. 

    <p>Statements do not return values, but they are used to perform actions:</p>
<pre class="blue">
  <i>stmt</i> ::= <i>expr</i> <b>;</b>                                <span class="comment"># evaluate expression (drop the result)</span>
           <i>id</i> <b>=</b> <i>expr</i> <b>;</b>                           <span class="comment"># assignment to a variable</span>
	   <b>print</b> <i>expr</i> <b>,</b> ... <b>;</b>                    <span class="comment"># print values (on the same line)</span>
	   <i>expr</i> <b>[</b> <i>expr</i> <b>]</b> <b>=</b> <i>expr</i> <b>;</b>                <span class="comment"># assign to array or dictionary element</span>
           <b>if</b> <b>(</b> <i>expr</i> <b>)</b> <i>body</i>                      <span class="comment"># conditional</span>
           <b>if</b> <b>(</b> <i>expr</i> <b>)</b> <i>body</i> <b>else</b> <i>body</i>            <span class="comment"># conditional</span>
	   <b>while</b> <b>(</b> <i>expr</i> <b>)</b> <i>body</i>                   <span class="comment"># loop </span>
	   <b>for</b> <b>(</b> <i>id</i> <b>in</b> <i>expr</i> <b>)</b> <i>body</i>               <span class="comment"># iteration over elements of an array</span>

  <i>body</i> ::= <b>{</b> <i>decl</i> ... <i>stmt</i> ... <b>}</b>         <span class="comment"># zero of more declarations followed by zero or more statements</span>
</pre>

    <p>A statement is ended either by a semicolon <tt><b>;</b></tt> or by a closing brace <tt><b>}</b></tt> when that statement has a body. I think The only times a closing brace has to be following by a semicolon is when you assign a function to a variable, such as:</p>
      <pre>
  f = fun(a,b) { a+b;};</pre>

    <p>Note that a naked expression <tt><i>expr;</i></tt> can be a statement. This is useful in two ways.</p>

    <p>
      First, we can use it to call a function as a statement: since
      the body of a function is a statement or block of statements,
      calling a function can perform actions (like in Javascript and
      Python, and unlike what we did in Homework 6 &mdash; compare and
      constrast).</p>

    <p>Second, we can use it to return a value from a function. The
    rule is that a naked expressions evaluates to a value but that
    value is not used, <i>unless</i> it is the last thing a
    function does before finishing, in which case the result of the
    evaluation is the result of the function call. The following
    anonymous function, for instance, simply returns its argument:</p>  
    <pre>
  var identity = fun (x) { x; }</pre>

    <p>The following function is our usual definition of <tt>sum()</tt> as an anonymous recursive function:</p>
    <pre>
  var sum = fun s (n) {
    if (n == 0) {
      0;
    } else {
      n + s(n-1);
    }
  }</pre>

    <p>I'll provide more examples below.</p>

    <p>The <tt>for</tt> loop is like the one in Python. A
      statement <tt>for (x in arr) <i>body</i></tt> creates a new binding
      for <tt>x</tt> and then for every element of array <tt>arr</tt>
      going from left to right 
      binds <tt>x</tt> to that element and executes <i>body</i>. 
    
    <p>Declarations define new variables (via <tt>var</tt>) or recursive functions (via <tt>def</tt>):</p>
<pre class="blue">
  <i>decl</i> ::= <b>var</b> <i>id</i> <b>;</b>
           <b>var</b> <i>id</i> <b>=</b> <i>expr</i> <b>;</b>
           <b>def</b> <i>id</i> <b>(</b> <i>id</i> <b>,</b> ... <b>)</b> <i>body</i>       <span class="comment"># function definition</span>
</pre>
<p>Declaring a variable or function that already exists does not destroy the previous variables or functions of the same name, it hides them. Variables and functions defined within a body are local to that body,  and disappear when the body finishes executing.</p>
    <p>The initial environment contains predefined functions. The only function I'm requiring you to put in the initial environment is <tt>len(<i>x</i>)</tt>, which computes the length of an array or of a string. Feel free to add whichever other predefined functions you find useful to the initial environment.</p>

    <h3>Programs</h3>
    
    <p>A <i>program</i> is a sequence of declarations. For example:</p>
<pre>
   def count_to_zero (n) {
     while (n >= 0) {
       print n;
       n = n - 1;
     }
   }
   
   def main () {
     print "Hello, world!";
     count_to_zero(10);
   }
</pre>
    <p>Programs should define a function <tt>main()</tt> of no arguments. Intuitively, executing a program means calling <tt>main()</tt>.</p>

    <h3>The Interpreter</h3>
    
    <p>The main interface to your interpreter should be a function <tt class="code">execute(<i>filename</i>)</tt> that takes a filename containing a program as an argument, and executes function <tt>main()</tt> contained in the program. Of course, this should invoke an interpreter that you have to write that will execute the code in the program.</p>

    <p>Write your <tt>homework7.py</tt> code in such a way that you can invoke the interpreter directly from the command-line, so that for instance:
<pre>
  python homework7.py test.pj
</pre>
would run the interpreter on the program in <tt>test.pj</tt>
</p>
</body>
</html>
